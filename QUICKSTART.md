# 🎉 Excel 合并工具 Web 版 - 已成功部署!

## ✅ 系统状态

- ✅ Django 已安装
- ✅ 数据库已初始化
- ✅ 开发服务器已启动
- ✅ 所有功能模块已就绪

## 🚀 立即使用

### 访问地址

**主页**: http://127.0.0.1:8000/

打开浏览器访问上述地址即可开始使用!

## 📖 功能导航

### 1. 首页 (/)
- 功能介绍
- 快速开始
- 最近任务

### 2. 创建任务 (/tasks/create/)
- **步骤 1**: 输入任务名称和选择输出格式
- **步骤 2**: 上传 Excel 文件 (.xlsx)
- **步骤 3**: (可选) 配置列派生规则
- **步骤 4**: (可选) 配置单元格批量操作
- **步骤 5**: 执行处理并下载结果

### 3. 任务列表 (/tasks/)
- 查看所有任务
- 查看任务状态
- 下载结果文件
- 删除任务

### 4. 任务详情 (/tasks/<id>/)
- 查看任务详细信息
- 查看上传文件列表
- 查看配置的规则和操作
- 下载结果文件

## 🎯 快速示例

### 示例 1: 简单合并

1. 访问 http://127.0.0.1:8000/
2. 点击"开始使用"
3. 输入任务名称: `学生信息合并`
4. 选择输出格式: `XLSX`
5. 上传多个学生信息表
6. 跳过规则配置,直接点"下一步"
7. 点击"开始处理"
8. 等待完成后下载结果

### 示例 2: 根据学号生成班级

1. 创建任务: `学生信息带班级`
2. 上传学生信息表
3. 在步骤 3 勾选"启用列派生规则":
   - 源列名: `学号`
   - 新列名: `班级`
   - 勾选"启用子串提取"
   - 起始位置: `6`, 结束位置: `10`, 勾选"使用1索引"
   - 添加映射:
     * 模式: `0201`, 值: `植保1班`
     * 模式: `0202`, 值: `植保2班`
4. 执行处理

### 示例 3: 清理手机号

1. 创建任务: `清理手机号格式`
2. 上传联系人表
3. 跳过列规则
4. 在步骤 4 添加操作:
   - 操作 1: 列名 `手机号`, 操作 `删除前缀`, 值 `+86`
   - 操作 2: 列名 `手机号`, 操作 `替换文本`, 旧值 `-`, 新值 (留空)
5. 执行处理

## 🛠️ 管理功能

### 访问管理后台

URL: http://127.0.0.1:8000/admin/

需要先创建管理员账号:
```powershell
cd "d:\桌面\excel_work\excel_merger_web"
python manage.py createsuperuser
```

然后输入用户名、邮箱和密码即可登录管理后台。

管理后台可以:
- 查看所有任务和详细信息
- 批量删除任务
- 编辑规则和操作
- 查看上传文件

## 📂 项目文件说明

```
excel_merger_web/
├── db.sqlite3              # SQLite 数据库
├── manage.py               # Django 管理脚本
├── media/                  # 媒体文件目录
│   ├── uploads/            # 用户上传的 Excel 文件
│   └── results/            # 处理后的结果文件
├── excel_merger_web/       # 项目配置
│   ├── settings.py         # 项目设置
│   ├── urls.py             # 主路由
│   └── wsgi.py             # WSGI 配置
└── merger/                 # 主应用
    ├── models.py           # 数据模型(MergeTask 等)
    ├── views.py            # 视图函数
    ├── urls.py             # 应用路由
    ├── admin.py            # 管理后台配置
    ├── core/               # 核心逻辑
    │   └── excel_processor.py  # Excel 处理核心代码
    ├── templates/          # HTML 模板
    │   ├── base.html       # 基础模板
    │   └── merger/         # 应用模板
    │       ├── index.html        # 首页
    │       ├── task_create.html  # 创建任务
    │       ├── task_list.html    # 任务列表
    │       └── task_detail.html  # 任务详情
    └── static/             # 静态文件
        ├── css/
        │   └── style.css   # 样式文件
        └── js/
            └── main.js     # JavaScript
```

## 🔧 常用命令

### 启动服务器
```powershell
cd "d:\桌面\excel_work\excel_merger_web"
python manage.py runserver
```

### 停止服务器
在运行服务器的终端按 `Ctrl+C`

### 使用其他端口
```powershell
python manage.py runserver 8001
```

### 创建管理员
```powershell
python manage.py createsuperuser
```

### 重置数据库
```powershell
Remove-Item db.sqlite3
python manage.py migrate
```

### 清理上传文件
```powershell
Remove-Item -Recurse media\uploads\*
Remove-Item -Recurse media\results\*
```

## 💡 使用技巧

### 1. 拖拽上传
在文件上传区域可以直接拖拽文件,无需点击选择。

### 2. 批量添加映射规则
在列规则配置中,可以多次点击"添加映射"按钮创建多个规则。

### 3. 链式操作
单元格操作支持对同一列应用多个操作,按添加顺序执行。

### 4. 实时保存
每个步骤的配置都会立即保存到数据库,可以随时中断和继续。

### 5. 历史任务复用
可以查看历史任务的配置,作为新任务的参考。

## 📊 性能说明

- 支持单个文件最大 10MB(可在 settings.py 中调整)
- 推荐单次合并文件数量 < 50 个
- 大文件处理可能需要几分钟时间
- XLSX 格式支持图片,XLS 不支持

## 🐛 常见问题

### Q: 上传后看不到文件?
A: 检查文件格式是否为 .xlsx,刷新页面重试。

### Q: 处理失败?
A: 查看任务详情页的错误信息,检查:
- 文件是否损坏
- 列名是否正确
- 规则配置是否有误

### Q: 如何修改任务配置?
A: 当前版本不支持修改,可以删除任务重新创建。

### Q: 结果文件在哪?
A: 在 `media/results/` 目录,也可以在任务列表页直接下载。

## 🎨 界面说明

### 导航栏
- **首页**: 返回主页
- **任务列表**: 查看所有任务
- **创建任务**: 创建新的合并任务

### 颜色标识
- 🔵 **蓝色** - 主要操作按钮
- 🟢 **绿色** - 成功状态
- 🔴 **红色** - 错误或删除操作
- 🟡 **黄色** - 等待或处理中状态
- ⚪ **灰色** - 次要操作

### 任务状态
- **等待处理** - 黄色标签
- **处理中** - 蓝色标签
- **已完成** - 绿色标签
- **失败** - 红色标签

## 📱 响应式设计

界面适配多种屏幕尺寸:
- 💻 桌面端 (推荐)
- 📱 平板
- 📱 手机

在小屏幕上,部分布局会自动调整为单列显示。

## 🔄 后续扩展

如需添加新功能,可以:

1. **添加新的操作类型**: 修改 `CellOperation.ACTION_CHOICES`
2. **自定义样式**: 修改 `merger/static/css/style.css`
3. **添加验证**: 在 `views.py` 中添加数据验证逻辑
4. **批量任务**: 扩展模型支持批量任务队列
5. **定时任务**: 集成 Celery 支持异步处理

## 📞 技术支持

遇到问题可以:
1. 查看浏览器控制台错误信息(F12)
2. 查看服务器终端输出
3. 检查 Django 日志
4. 查看数据库内容(使用 SQLite 浏览器)

## 🎊 开始使用吧!

一切准备就绪,现在就可以开始使用 Excel 合并工具了!

**访问地址**: http://127.0.0.1:8000/

祝使用愉快! 🚀
