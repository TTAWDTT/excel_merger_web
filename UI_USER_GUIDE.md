# Excel合并工具 - 新功能使用指南

## 🎯 概述

现在您可以通过友好的Web界面使用所有增强功能！任务创建流程已扩展为**5个步骤**，每个步骤都有清晰的界面。

## 📋 功能使用步骤

### 步骤1: 基本配置
- 输入任务名称
- 选择输出格式（XLSX, XLS, CSV, JSON）
- 配置列过滤规则（可选）

### 步骤2: 上传文件
- 点击或拖拽上传Excel/CSV/JSON文件
- 支持批量上传多个文件
- 查看已上传文件列表

### **步骤3: 数据预览与清洗** ⭐ 新增功能

#### 3.1 配置模板管理
**保存常用配置，一键应用**

- **应用模板**：
  1. 点击"应用模板"下拉框
  2. 选择之前保存的模板
  3. 确认后自动填充所有配置

- **保存新模板**：
  1. 配置好所有设置后
  2. 在"保存为新模板"输入框输入模板名称
  3. 点击"保存模板"按钮
  4. 模板会保存当前所有配置（列过滤、清洗规则、验证规则、列派生规则等）

#### 3.2 文件预览
**查看上传文件的数据内容**

- 点击任何已上传文件旁的 **"预览数据"** 按钮
- 预览窗口显示：
  - ✅ 前100行数据表格
  - ✅ 总行数/列数/预览行数统计
  - ✅ 每列的数据类型（int, float, str, datetime等）
  - ✅ 每列的空值数量统计

#### 3.3 数据清洗规则
**配置自动化数据清洗**

支持的清洗规则：
1. **去除重复行** - 删除完全相同的行
2. **填充空值** - 用指定值填充空单元格
   - 参数示例: `{"value": "未知"}`
3. **去除空格** - 删除单元格前后空格
4. **标准化大小写** - 统一转换为大写/小写
   - 参数示例: `{"case": "upper"}` 或 `{"case": "lower"}`
5. **标准化日期** - 统一日期格式
   - 参数示例: `{"format": "%Y-%m-%d"}`
6. **移除特殊字符** - 删除非字母数字字符
7. **标准化电话号码** - 统一电话号码格式

**使用方法**：
1. 选择规则类型
2. 输入应用列名（留空=应用到所有列）
3. 输入参数（JSON格式，可选）
4. 点击"添加规则"
5. 规则会按顺序执行，可添加多个

#### 3.4 数据验证规则
**检查数据质量**

支持的验证规则：
1. **类型检查** - 验证数据类型
   - 参数: `{"type": "int"}` 或 `{"type": "float"}` 或 `{"type": "str"}`
2. **范围验证** - 检查数值范围
   - 参数: `{"min": 0, "max": 100}`
3. **正则匹配** - 用正则表达式验证格式
   - 参数: `{"pattern": "^[A-Z]{2}\\d{4}$"}`
4. **非空检查** - 确保不为空
5. **唯一性检查** - 检查是否有重复值
6. **长度检查** - 验证字符串长度
   - 参数: `{"min": 5, "max": 20}`
7. **枚举值检查** - 验证值在指定列表中
   - 参数: `{"allowed": ["男", "女"]}`

**使用方法**：
1. 选择验证类型
2. **必须**输入验证列名
3. 输入参数（JSON格式，根据类型）
4. 点击"添加验证"
5. 添加所有规则后，点击"运行数据验证"
6. 查看验证结果，显示所有错误行

### 步骤4: 高级设置
- 配置列派生规则（从现有列创建新列）
- 设置单元格批量操作（替换、添加前缀/后缀等）

### **步骤5: 确认执行**
- 查看所有配置汇总
- 点击"开始处理"执行合并
- **点击"生成统计图表"** ⭐ 查看数据可视化

#### 5.1 统计图表功能
**自动生成数据分析图表**

生成的图表类型：
- 📊 **数值列统计** - 柱状图（最大值、最小值、平均值、中位数）
- 🥧 **分类列分布** - 饼图（值分布情况）
- 📈 **数据概览** - 基础统计信息

**使用方法**：
1. 完成任务处理后
2. 点击"生成统计图表"按钮
3. 等待图表生成（自动分析数据）
4. 在弹窗中查看所有图表

## 🎨 界面说明

### 视觉特点
- ✅ **进度指示器** - 顶部显示5个步骤，当前步骤高亮
- ✅ **清晰分区** - 每个功能模块有独立区域和标题
- ✅ **实时预览** - 文件列表、规则列表实时更新
- ✅ **模态弹窗** - 预览和图表在大窗口中显示
- ✅ **加载提示** - 处理时显示"加载中"遮罩

### 交互提示
- 🔵 蓝色按钮 - 主要操作
- 🟢 绿色按钮 - 确认/执行
- 🔴 红色按钮 - 删除操作
- ⚪ 灰色按钮 - 次要/返回操作

## 📝 使用示例

### 示例1: 数据清洗工作流

```
1. 创建任务 "学生成绩清洗"
2. 上传 students.xlsx
3. 在步骤3中：
   - 点击"预览数据"查看原始数据
   - 添加清洗规则：
     * 去除重复行
     * 填充空值 - 列名: 成绩, 参数: {"value": "0"}
     * 标准化大小写 - 列名: 姓名, 参数: {"case": "upper"}
   - 添加验证规则：
     * 范围验证 - 列名: 成绩, 参数: {"min": 0, "max": 100}
     * 非空检查 - 列名: 学号
   - 点击"运行数据验证"查看是否有问题
4. 继续到步骤5，开始处理
5. 点击"生成统计图表"查看成绩分布
```

### 示例2: 使用模板快速配置

```
1. 首次配置好所有规则后，保存为模板 "标准学生数据处理"
2. 下次处理类似数据时：
   - 创建新任务
   - 上传文件
   - 在步骤3选择模板 "标准学生数据处理"
   - 自动应用所有配置
   - 直接执行
```

## 🔧 参数格式说明

所有JSON参数必须使用**双引号**，格式示例：

```json
✅ 正确:
{"value": "未知"}
{"min": 0, "max": 100}
{"type": "int"}
{"pattern": "^\\d{11}$"}
{"allowed": ["男", "女", "未知"]}

❌ 错误:
{'value': '未知'}  # 使用了单引号
{value: "未知"}     # 键没有引号
{"value": 未知}     # 字符串值没有引号
```

## ⚠️ 注意事项

1. **文件预览**：只显示前100行，但处理时会处理全部数据
2. **规则顺序**：清洗规则按添加顺序执行，顺序可能影响结果
3. **验证vs清洗**：验证只检查不修改，清洗会修改数据
4. **模板保存时机**：需要先创建任务（完成步骤1-2）才能保存模板
5. **图表生成**：需要先处理任务完成后才能生成图表

## 🚀 快速上手

**最简单的使用方式**：
1. 步骤1：输入任务名，选择格式
2. 步骤2：上传文件
3. 步骤3：点击"预览数据"查看数据
4. 步骤4：跳过（可选配置）
5. 步骤5：点击"开始处理"

**完整功能体验**：
1. 步骤1-2：基本配置和上传
2. 步骤3：
   - 预览每个文件
   - 添加2-3个清洗规则
   - 添加2-3个验证规则
   - 运行验证查看结果
   - 保存为模板
3. 步骤4：配置列规则（如需要）
4. 步骤5：
   - 查看汇总
   - 开始处理
   - 生成统计图表

## 📊 功能清单

| 功能 | 位置 | 说明 |
|------|------|------|
| 模板管理 | 步骤3 | 保存/加载配置 |
| 文件预览 | 步骤3 | 查看数据前100行 |
| 数据清洗 | 步骤3 | 7种清洗规则 |
| 数据验证 | 步骤3 | 7种验证规则 |
| 统计图表 | 步骤5 | 自动生成分析图 |

## 🆘 常见问题

**Q: 我添加的规则在哪里查看？**
A: 添加后会在对应容器中显示列表，每条规则都有"删除"按钮。

**Q: 预览数据失败怎么办？**
A: 确保文件已成功上传，检查文件格式是否正确。

**Q: 验证规则的参数怎么写？**
A: 参考上面的"参数格式说明"部分，使用标准JSON格式。

**Q: 模板可以跨任务使用吗？**
A: 是的，保存的模板可以在任何新任务中应用。

**Q: 清洗规则会修改原文件吗？**
A: 不会，只在合并后的结果文件中应用清洗规则。

---

**享受强大的Excel数据处理体验！** 🎉
